# DataProcessor

![Flask](https://img.shields.io/badge/Flask-2.3.3-green.svg)
![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)

## ОБЩИЕ СВЕДЕНИЯ

**Обозначение и наименование программы:** DataProcessor  
**Версия:** 1.0  
**Класс программного обеспечения:** Веб-приложение для управления задачами анализа HDL проектов с использованием LibreLane

**Программное обеспечение, необходимое для функционирования:**
- Python 3.8 или выше
- Flask 2.3.3
- SQLAlchemy 2.0+
- SQLite 3.35+ (или PostgreSQL 12+)
- Зависимости из requirements.txt

**Языки программирования:**
- Backend: Python
- Frontend: JavaScript, HTML5, CSS3

## ФУНКЦИОНАЛЬНОЕ НАЗНАЧЕНИЕ

**Классы решаемых задач:**
- Управление задачами анализа HDL проектов
- Валидация конфигурационных файлов и исходных кодов
- Интеграция с системой LibreLane для выполнения анализа
- Отслеживание статуса выполнения задач в реальном времени
- Управление сессиями пользователей через email аутентификацию

**Назначение программы:** Профессиональный веб-интерфейс для управления задачами анализа HDL проектов с интеграцией в систему LibreLane.

**Функциональные ограничения на применение:**
- Максимальный размер файлов: 10MB (development), 5MB (production)
- Поддерживаемые форматы: JSON, YAML, YML, CONF (конфигурационные), V, VH, SV (HDL исходные коды)
- Длительность сессии: 4 часа

## ОПИСАНИЕ ЛОГИЧЕСКОЙ СТРУКТУРЫ

**Алгоритм программы:**
1. **Аутентификация** - Пользователь вводит email, получает magic link
2. **Загрузка файлов** - Загрузка конфигурационных и HDL файлов
3. **Валидация** - Проверка структуры и формата файлов
4. **Создание задачи** - Создание Run объекта в базе данных
5. **Интеграция с LibreLane** - Отправка задачи во внешнюю систему
6. **Отслеживание статуса** - Мониторинг прогресса выполнения
7. **Получение результатов** - Скачивание архивов с результатами

**Используемые методы:**
- Модульная архитектура на основе Flask Blueprints
- Сессионная аутентификация через magic links
- REST API для взаимодействия с фронтендом
- Интеграция с LibreLane через сервисный слой
- Валидация файлов перед обработкой
- Логирование всех операций

**Структура программы:**

**Маршрутизация (routes/):**
- `auth.py` - управление аутентификацией (email login, magic links, logout)
- `api.py` - REST API endpoints (upload, status, logs, download, cancel)
- `website.py` - веб-страницы (help, upload, status, logs, results)

**Сервисы (services/):**
- `auth_service.py` - управление сессиями пользователей
- `run_service.py` - управление задачами выполнения
- `librelane_service.py` - интеграция с LibreLane системой
- `validation_service.py` - валидация загружаемых файлов

**Модели данных (models/):**
- `run.py` - модель задачи выполнения (Run)
- `session.py` - модель пользовательской сессии

**Конфигурация (config.py):**
- Поддержка multiple environments (development, testing, production)
- Настройки безопасности и сессий
- Параметры файловой системы и ограничения

**Функции составных частей:**
- **Аутентификация**: Magic link система с временными сессиями
- **Загрузка файлов**: Разделение на конфигурационные и исходные файлы
- **Валидация**: Проверка расширений и структуры файлов
- **Управление задачами**: Полный lifecycle задач (создание, выполнение, отмена)
- **Мониторинг**: Отслеживание статуса и логов выполнения
- **Безопасность**: Система декораторов для контроля доступа

**Связи программы с другими программами:**
- Интеграция с системой LibreLane через HTTP API
- Взаимодействие с SMTP сервером для отправки email уведомлений
- Использование веб-браузеров для отображения пользовательского интерфейса
- Работа с системами управления базами данных (SQLite/PostgreSQL)

## ИСПОЛЬЗУЕМЫЕ ТЕХНИЧЕСКИЕ СРЕДСТВА

**Типы электронных вычислительных машин и устройств:**
- Серверные платформы: x86-64 архитектура
- Минимальный объем ОЗУ: 2 ГБ
- Минимальный объем дискового пространства: 100 МБ
- Сетевые адаптеры: Ethernet 100/1000 Мбит/с
- Устройства ввода-вывода: клавиатура, монитор

**Минимальные требования:**
- Процессор: 1 ГГц или выше
- Оперативная память: 2 ГБ
- Свободное место на диске: 100 МБ
- Сетевое подключение для доступа к LibreLane

**Рекомендуемые требования:**
- Процессор: 2 ГГц или выше (многоядерный)
- Оперативная память: 4 ГБ или больше
- Свободное место на диске: 1 ГБ (для хранения задач)
- Высокоскоростное сетевое подключение

**Поддерживаемые платформы:**
- Windows 10/11
- Linux (Ubuntu 18.04+, CentOS 7+)
- macOS 10.15+

**Программное окружение:**
- Веб-сервер: Flask development server (разработка), Gunicorn (продакшен)
- База данных: SQLite (по умолчанию), PostgreSQL (опционально)
- Браузер: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

## ВЫЗОВ И ЗАГРУЗКА

**Способ вызова программы:**
```bash
# Клонирование репозитория
git clone git@github.com:AndB0ndar/DataProcessor.git
cd data_processor

# Активация виртуального окружения
python -m venv venv
source venv/bin/activate  # Linux/MacOS
venv\Scripts\activate     # Windows

# Установка зависимостей
pip install -r requirements.txt

# Запуск приложения
python run.py
# или
flask run
```

**Входные точки в программу:**
- Веб-интерфейс: `http://localhost:5000`
- Аутентификация: `http://localhost:5000/auth/`
- REST API: `http://localhost:5000/api/`
- Страница загрузки: `http://localhost:5000/upload`

**Использование оперативной памяти:**
- Базовое потребление: ~100-200 МБ
- При активной обработке задач: до 500 МБ

**Объем программы:** ~10-20 МБ (исходный код и зависимости)

## ВХОДНЫЕ ДАННЫЕ

**Характер и организация:**
- Конфигурационные файлы в форматах: JSON, YAML, YML, CONF
- Исходные коды HDL: Verilog (.v), SystemVerilog (.sv), заголовочные файлы (.vh)
- Множественная загрузка файлов через веб-интерфейс

**Формат и описание конфигурационных файлов:**
```json
{
  "project_name": "example_project",
  "target_frequency": 100,
  "constraints": {
    "clock_period": 10
  }
}
```

**Способ кодирования:** UTF-8

**Требования к файлам:**
- Конфигурационные файлы: должны иметь соответствующие расширения
- HDL файлы: должны соответствовать синтаксису Verilog/SystemVerilog
- Максимальный размер: 10MB на файл

## ВЫХОДНЫЕ ДАННЫЕ

**Характер и организация:**
- Архивы с результатами анализа в формате .tar или .tar.gz
- Логи выполнения с детальной информацией о процессе
- Статус выполнения задачи (в процессе, завершено, ошибка)
- Метрики анализа и временные характеристики

**Формат и описание:**
- `results.tar.gz` - архив с полными результатами анализа
- `processing_logs.txt` - детальные логи выполнения
- JSON ответы API со статусом задачи

**Способ кодирования:** UTF-8 для логов, бинарный для архивов

## УСТАНОВКА И НАСТРОЙКА

### Предварительные требования
- Python 3.8 или выше
- pip (менеджер пакетов Python)
- Доступ к серверу LibreLane

### Установка
```bash
git clone git@github.com:AndB0ndar/DataProcessor.git
cd data_processor

python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### Конфигурация
Создайте файл `.env`:
```bash
FLASK_CONFIG=development
SECRET_KEY=your-secret-key-here
FLASK_HOST=0.0.0.0
FLASK_PORT=5000
DATABASE_URL=sqlite:///librelane.db
LIBRELANE_API_KEY=your-librelane-api-key
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-email-password
```

### Запуск
```bash
python run.py
```
Приложение доступно по адресу: `http://localhost:5000`

## ИСПОЛЬЗОВАНИЕ

### Основной workflow
1. **Аутентификация** - Ввод email на странице логина, получение magic link
2. **Загрузка файлов** - Выбор конфигурационных и HDL файлов на странице upload
3. **Валидация** - Автоматическая проверка файлов перед обработкой
4. **Запуск анализа** - Автоматическая отправка задачи в LibreLane
5. **Мониторинг** - Отслеживание прогресса на страницах status и logs
6. **Результаты** - Скачивание архивов с результатами после завершения

### Веб-интерфейс
- **Аутентификация** - Страница входа по email с magic links
- **Загрузка** - Интерфейс загрузки конфигурационных и HDL файлов
- **Статус** - Мониторинг прогресса выполнения задачи
- **Логи** - Просмотр детальных логов выполнения
- **Результаты** - Управление и скачивание результатов анализа
- **Справка** - Документация и справочная информация

## API ENDPOINTS

### Аутентификация
| Метод | Endpoint | Описание |
|-------|----------|----------|
| `GET/POST` | `/auth/` | Страница аутентификации по email |
| `GET` | `/auth/login/<token>` | Вход по magic link |
| `GET` | `/auth/logout` | Выход из системы |

### Управление задачами
| Метод | Endpoint | Описание |
|-------|----------|----------|
| `POST` | `/api/upload` | Загрузка файлов и создание задачи |
| `GET` | `/api/<run_id>/status` | Получение статуса задачи |
| `GET` | `/api/<run_id>/logs` | Получение логов выполнения |
| `GET` | `/api/<run_id>/download` | Скачивание результатов |
| `POST` | `/api/<run_id>/cancel` | Отмена выполнения задачи |

### Веб-страницы
| Метод | Endpoint | Описание |
|-------|----------|----------|
| `GET` | `/help` | Страница справки |
| `GET` | `/upload` | Страница загрузки файлов |
| `GET` | `/<run_id>` | Страница статуса задачи |
| `GET` | `/<run_id>/logs` | Страница логов |
| `GET` | `/<run_id>/results` | Страница результатов |

### Пример использования API
```python
import requests

# Note: API requires session authentication via magic links

# После аутентификации через веб-интерфейс
session_cookie = "your_session_cookie"

headers = {'Cookie': f'session={session_cookie}'}

# Загрузка файлов
files = {
    'files': [
        ('config.json', open('config.json', 'rb'), 'application/json'),
        ('design.v', open('design.v', 'rb'), 'text/plain')
    ]
}

response = requests.post('http://localhost:5000/api/upload', 
                        files=files, headers=headers)
task_id = response.json()['run_id']

# Проверка статуса
status = requests.get(f'http://localhost:5000/api/{task_id}/status', 
                     headers=headers)
```

## СИСТЕМА БЕЗОПАСНОСТИ

**Аутентификация:**
- Magic links через email
- Временные сессии длительностью 4 часа
- Автоматический выход при истечении сессии

**Контроль доступа:**
- Декораторы для проверки прав доступа к задачам
- Валидация владения задачами (`run_ownership_required`)
- Проверка статуса задач перед операциями
- Защита от параллельного выполнения задач

**Валидация данных:**
- Проверка MIME types и расширений файлов
- Валидация структуры конфигурационных файлов
- Ограничение размеров загружаемых файлов

## ТЕСТИРОВАНИЕ

```bash
# Установка зависимостей для тестирования
pip install pytest pytest-flask

# Запуск тестов
export FLASK_CONFIG=testing
pytest

# Запуск с покрытием кода
pytest --cov=app tests/
```

## КОНФИГУРАЦИЯ

### Режимы работы
- **development** - Режим разработки с детальным логированием и отладкой
- **testing** - Режим тестирования с изолированными папками и тестовой БД
- **production** - Продакшен режим с оптимизацией безопасности

### Переменные окружения
| Переменная | По умолчанию | Описание |
|------------|--------------|----------|
| `FLASK_CONFIG` | `development` | Режим работы приложения |
| `SECRET_KEY` | - | Секретный ключ для сессий |
| `DATABASE_URL` | `sqlite:///librelane.db` | URL подключения к БД |
| `LIBRELANE_API_KEY` | - | API ключ для интеграции с LibreLane |
| `RUNS_FOLDER` | `runs` | Папка для хранения задач |
| `MAIL_SERVER` | `smtp.gmail.com` | SMTP сервер для отправки email |

## ЛИЦЕНЗИЯ

Не определена

